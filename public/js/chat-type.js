$(function(){    var n              = 1;    var addPrivateChat = function(obj) {        var chat   = obj.attr("href").split("#");        chat       = chat[chat.length - 1];        var params = {            "chat_type" : chat,            "users_id"  : $( "#created_by" ).val(),            "leader"    : $( "#created_by" ).val()        };        request("/chat/ajax/add-private-user", params, "chat-content");        obj.click(function(event) {            event.preventDefault();            request("/chat/ajax/messages", {"chat_type" : chat}, "chat-content");            $( "#chat_type" ).val(chat);            $( "#chat-main a" ).removeClass("selected");            $( this ).addClass("selected");        });        request("/chat/ajax/messages", {"chat_type" : chat}, "chat-content");        $( "#chat_type" ).val(chat);        $( "#chat-main a" ).removeClass("selected");        obj.addClass("selected");    }    var closeChat = function(obj) {        obj.click(function(){            var closeChat   = obj.parent().find("a").attr("href").split("#");            closeChat       = closeChat[closeChat.length - 1];            var currentChat = $( "#chat_type" ).val();            $( this ).parent().hide();            request("/chat/ajax/close", {"chat_type" : closeChat});            if (currentChat == closeChat) {                $( "#chat_type" ).val("public");                $( "#public_chat" ).addClass("selected");            }        });    }    $( "#chat-main a" ).click(function(event){        event.preventDefault();        $( "#chat-main #chat-tabs a" ).removeClass("selected");        $( this ).addClass("selected");        if (/#public/i.test($( this ).attr("href")) === true) {            request("/chat/ajax/messages", {"chat_type" : "public"}, "chat-content");            $( "#chat_type" ).val("public");        }        if ($( this ).html() == "+") {            var d    = new Date();            var div  = $("<div />", {"class" : "tab"});            var a    = $("<a />", {"href" : ("#" + d.getTime())}).html("Privado " + n++);            var span = $("<span />", {"class" : "close"}).html("X");            div.append(a).append(span);            $( this ).parent().before(div);            addPrivateChat(a);            closeChat(span);        }    });});